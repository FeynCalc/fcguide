%% $Id: notebook2e.sty,v 1.10 2001/02/10 20:56:02 daleh Exp $
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% Copyright (c) 1996-1999 Wolfram Research, Inc.  All rights reserved.  
%% Distribution of this file is permitted without express consent of 
%% Wolfram Research; however, this file may only be used in conjunction
%% with files generated by Mathematica. Mathematica is a registered
%% trademark of Wolfram Research, Inc.
%%
%% notebook2e.sty:  
%%    LaTeX2e macro file for the Mathematica TeXSave command.  
%%    Look for updates of this file and notebook.sty
%%    at http://www.wolfram.com/support/FrontEnds/Export/TeX/ 
%%
%% Sample .tex file:
%%
%%    \documentclass{article}
%%    \usepackage{notebook2e}
%%    \begin{document}
%%    output from TeXSave minus the normal LaTeX header and footer
%%    \end{document}
%%
%% Since this macro file can be updated by Wolfram Research, Inc.,
%% it is advised to not make any changes to this file.  If you
%% would like to add or modify the behavior of this style, it is
%% suggested that you make a new .sty file, named testnotebook.sty
%% for this example, and at the top of the testnotebook.sty put the line:
%%
%%    \usepackage{notebook2e}
%%   
%% and then make whatever changes you like to the default notebook style
%% in this testnotebook.sty.  In the .tex file, change the header line,
%% \usepackage{notebook2e} to \usepackage{testnotebook}.
%%
%% For the best results with TeXSave you will want to download Jens-Peers
%% Kuska's virtual TeX font package that makes use of Mathematica's fonts 
%% for TeX/LaTeX. You can find the package on MathSource.
%%
%% Changes
%% -------
%%  
%%   ** 12-20-98 **
%%   Added a series of new macros so that notebook2e.sty
%%   can handle any distributed Mathematica Style, not just
%%   the Default stylesheet.
%%
%%   ** 8-12-98 ** 
%%   Changed \circledR to represent \[RegisteredTrademark] instead of 
%%   \copyright.  Added \LeftSkeleton and \RightSkeleton and modified
%%   \mathin, \mathout, and \mathtext to use mono space math characters.
%%
%%   ** 8-7-98 **
%%   Added macros \circledR (\copyright) and \Trademark
%%
%%   ** 6-29-98 **
%%	 Added macros \FilledSquare and \FilledCircle and changed the
%%	 default Mathematica example spacing.  Also added definitions for
%%	 \CellGroup \endCellGroup \multsp and \imag
%%
%%   ** 4-15-98 **
%% - Added macro definitions for \LeftDoubleBracketingBar, 
%%   \RightBracketingBar, and \Square.
%%
%%   ** 4-6-98 **                                   
%% - Heading macros changed to be flush left to
%%   mimic Mathematica 3.0 Default Notebook Style Sheet look.
%% - Paragraph indents suppressed to copy Default FE behavior.
%% - \GrayOne, \GrayTwo, and \graybox macros added for making
%%     boxed items with gray backgrounds.
%% - \button[buttonstyle]{contents} macro created for ButtonStyles.
%% - \SkeletonIndicator defined to be "-".
%% - \dispSFNumberedEquationmath created to display mono math
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{notebook2e}[1998/06/29 LaTeX2e macros for TeXSave output]
\typeout{TeXSave Output Macro Package}

%%% Load in Jens-Peer Kuska's virtual Mathematica font package with
%%% the monospacemath option set if the file exists in the TeX environment.  
%%% If it doesn't exist, it can be found on MathSource.
%%%
\IfFileExists{wrisym.sty}{\usepackage[monospacemath]{wrisym}}
	{\typeout{**********}%
	\typeout{I can't find wrisym.sty.  It's free on MathSource 
													(www.mathsource.com)}%
	\typeout{as part of the wrifnt.tar package.  It can be}%
	\typeout{found by searching for "wrifnt" or "virtual TeX fonts".}%
	\typeout{LaTeX stopping, please add wrisym.sty and fonts to your TeX environment}%
	\typeout{**********}%
	\end{document}}


%% Heading Macros
\long\def\Title#1{%
 \long\def\@maketitle{%
  \newpage
  \null
  \vskip 2em%
%  \begin{center}%
  \parindent 0pt\let \footnote \thanks
    {\LARGE \@title \par}%
%    \vskip 1.5em%
%    {\large
%      \lineskip .5em%
%      \begin{tabular}[t]{c}%
%        @author
%      \end{tabular}\par}%
%    \vskip 1em%
%    {\large \@date}%
%  \end{center}%
  \par
  \vskip 1.5em}%
\title{#1}\author{}\maketitle}
\def\Author#1{{\parindent 0pt\itshape #1\par}\vskip 12pt}

\long\def\Subtitle#1{{\par\parindent 0pt%\rightskip 0pt plus 1fill%
		%\leftskip 0pt plus 1fill%
		\large #1\par}\vskip .75em\@afterindentfalse\@afterheading}
\long\def\Subsubtitle#1{{\par\parindent 0pt%\rightskip 0pt plus 1fill%
		%\leftskip 0pt plus 1fill
		\large\itshape #1\par\vskip\baselineskip}%
		%\vskip .25em
        \@afterindentfalse\@afterheading}
\let\Section\section
\let\Subsection\subsection
\let\Subsubsection\subsubsection
\let\Subsubsubsection\subsubsection

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Inhibit paragraph indents to emulate Default 
%%  Style of FE notebooks. Also add a little space
%%  between paragraphs
\parindent 0pt \parskip 6pt
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Mathematica Input / Output Cell Macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newbox\Mathbox     % This box holds the array vbox

\def\dispSFNumberedEquationmath#1{{\mathversion{mono}%
	\begin{equation}
	#1
	\end{equation}}}

\def\dispTFNumberedEquationmath#1{%
	\begin{equation}
	#1
	\end{equation}}

\gdef\MathBegin#1{\def\tempa{\csname #1\endcsname}\tempa}
\gdef\MathEnd#1{\csname end#1\endcsname%
\ifallowmathbreak\splitmathbox\global\allowmathbreakfalse\else\ignorespaces\fi}
\newdimen\mathboxvar \mathboxvar=0pt
\def\splitmathbox{\dimen1=\ht\Mathbox 
    \ifdim\pagetotal < .9\pagegoal \advance\dimen1 by \pagetotal \fi
    \advance\dimen1 2.5\baselineskip 
    \ifdim\dimen1 < \vsize            % make sure it will fit on this page
        \vtop{\unvbox\Mathbox}
    \else                             % figure out how much will fit
                                      % on this page and print rest
        \dimen3=\pagegoal \advance\dimen3 by -\pagetotal%
        \ifpromptbreak\advance\dimen3 by -\baselineskip\fi%
	\advance\dimen3\mathboxvar
        \global\setbox0=\vsplit\Mathbox to \dimen3%
        \vtop{\unvbox0}\hfill\break%
		\loop                 %    while 2 columns are bigger than a page do
			\dimen0=\ht\Mathbox
			\ifdim\dimen0 > \textheight
				\dimen0=\textheight
				\global\setbox0=\vsplit\Mathbox to \dimen0
				\box0\hfill\break%
		\repeat
		\box\Mathbox%
    \fi}

\newif\ifallowmathbreak \allowmathbreakfalse
\def\MathArray{\@writabarray}
\def\@wriarrayacol{\edef\@preamble{\@preamble \hskip \arraycolsep}}

\def\@wriarrayclassz{\ifcase \@lastchclass \@acolampacol \or \@ampacol \or
   \or \or \@addamp \or
   \@acolampacol \or \@firstampfalse \@acol \fi
\edef\@preamble{\@preamble
  \ifcase \@chnum 
     \hfil$\relax\displaystyle\@sharp$\hfil \or $\relax\displaystyle\@sharp$\hfil 
    \or \hfil$\relax\displaystyle\@sharp$\fi}}

\def\@wriarrayclassiv{\@addtopreamble{$ \@nextchar$}}
\def\@addtopreamble#1{\edef\@preamble{\@preamble #1}}
\def\@wriarraycr{${\ifnum0=`}\fi\@ifstar{\@wrixarraycr}{\@wrixarraycr}}
\def\@wrixarraycr{\@ifnextchar[{\@argarraycr}{\ifnum0=`{\fi}${}\cr}}
\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[c]}}
\def\@wriarray[#1]#2{%
	\if#1p \global\allowmathbreaktrue \fi%
    \let\@acol\@wriarrayacol \let\@classz\@wriarrayclassz
    \let\@classiv\@wriarrayclassiv \let\\\@wriarraycr\def\@halignto{}
	\setbox\@arstrutbox=\hbox{\vrule 
     height\arraystretch \ht\strutbox
     depth\arraystretch \dp\strutbox
     width\z@}\@wrimkpream{#2}\edef\@preamble{\halign \noexpand\@halignto
\bgroup \tabskip\z@ \@arstrut \@preamble \tabskip\z@ \cr}%
\let\@startpbox\@@startpbox \let\@endpbox\@@endpbox
  \if #1t \vtop 
  \else \if#1b \vbox 
  \else \if#1p \global\setbox\Mathbox=\vbox
  \else \vcenter \fi\fi\fi
  \bgroup \let\par\relax
  \let\@sharp##\let\protect\relax \lineskip\z@\baselineskip\z@\@preamble}

\def\@wrimkpream#1{\@firstamptrue\@lastchclass6
\def\@preamble{}\def\protect{\noexpand\protect\noexpand}\let\@sharp\relax 
\let\@startpbox\relax\let\@endpbox\relax
\@wriexpast{#1}\expandafter\@writfor \expandafter
  \@nextchar \expandafter:\expandafter=\@tempa\do{\@writestpach\@nextchar
  \ifcase \@chclass \@classz \or \@classi \or \@classii \or \@classiii
    \or \@classiv \or\@classv \fi\@lastchclass\@chclass}%
\ifcase \@lastchclass \@acol
    \or \or \@preamerr \@ne\or \@preamerr \tw@\or \or \@acol \fi}

\def\@wriexpast#1{\@wrixexpast #1*0x\@@}
\def\@wrixexpast#1*#2#3#4\@@{\edef\@tempa{#1}\@tempcnta#2\relax
    \ifnum\@tempcnta >0 \@whilenum\@tempcnta >0\do
       {\edef\@tempa{\@tempa#3}\advance\@tempcnta by \m@ne}\let\@tempb\@wrixexpast
      \else \let\@tempb\@wrixexnoop\fi
    \expandafter\@tempb \@tempa #4\@@}

\def\@writestpach#1{\@chclass \ifnum \@lastchclass=\tw@ 4 \else 
    \ifnum \@lastchclass=3 5 \else
     \z@ \if #1c\@chnum \z@ \else
                              \if #1l\@chnum \@ne \else
                              \if #1r\@chnum \tw@ \else
          \@chclass \if #1|\@ne \else
                    \if #1@\tw@ \else
                    \if #1p3 \else \z@ \@preamerr 0\fi
  \fi  \fi  \fi  \fi  \fi  \fi  
\fi}

\def\@wrixexnoop #1\@@{}
\def\@writfor#1:=#2\do#3{\xdef\@fortmp{#2}\ifx\@fortmp\@empty \else
    \@writforloop#2\@nil\@nil\@@#1{#3}\fi}
\def\@writforloop#1#2\@@#3#4{\def#3{#1}\ifx #3\@nnil 
       \let\@nextwhile=\@fornoop \else
      #4\relax\let\@nextwhile=\@writforloop\fi\@nextwhile#2\@@#3{#4}}

\def\endMathArray{\crcr\egroup\egroup%
}

\def\SmallText#1{{\small #1}}
\def\Abstract#1{\begin{abstract}#1\end{abstract}}
\def\Address#1{\begin{quote}\itshape #1\end{quote}}
\def\Caption#1{\setbox0=\hbox{\small\bfseries #1}%
  \ifdim\wd0 < .75\hsize\relax
     \begin{center}\leavevmode\box0\end{center}
  \else 
     \begin{center}\leavevmode%
     \vbox{\hsize=.75\hsize\small\bfseries #1\par}\end{center}
  \fi}
\let\Commentary\Address     
\let\Definition\Address
\let\Example\Address
\let\Exercise\Address
\let\ExerciseMain\Address
\let\ExerciseText\Address
\let\Theorem\Address
\def\Copyright#1{\vskip 12pt{\footnotesize #1}\vskip 12pt}
\def\IndentedText#1{\begin{quote}#1\end{quote}}
\let\ItemizedTextNote\IndentedText
\def\ItemizedText#1{\vskip-\lastskip\vskip 6pt%
	\setbox0=\hbox{$\bullet$\kern 6pt}%
	\hangindent\wd0\hangafter=1 $\bullet$\kern 6pt #1\vskip 6pt}
\def\MathCaption#1{\vskip-\lastskip\vskip 6pt%
	\setbox0=\hbox{$\Square$\kern 6pt}%
	\hangindent\wd0\hangafter=1 $\Square$\kern 6pt #1\vskip 6pt}
\def\Note#1{\vskip 12pt{\fboxsep=6pt%
   \fbox{\vbox{\advance\hsize-12pt #1}}}\vskip 12pt}
\def\Reference#1{\vskip-\lastskip\vskip 6pt%
	\hangindent 12pt\hangafter=1 #1\vskip 6pt}
\def\Program#1{\vskip 12pt{\parindent 0pt\mv{#1}\par}\vskip 12pt}
\def\TextTop#1{\vskip 12pt\leavevmode\vtop{#1\par}\vskip 12pt}
	
 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%       Mathematica SESSION macros and settings.                        
%%%%
%%%%       \showprompts
%%%%            Changes notebook.sty's default and shows Input/Output
%%%%            prompts for the Mathematica examples.  By default
%%%%            an automatic prompt counter is used.
%%%%       \noprompts
%%%%            Turns the prompts off
%%%%       \promptfalse
%%%%            Turns off the prompt for only the next example.
%%%%       \NewSession
%%%%            To start a new Mathematica session 
%%%%             (reset the session prompt number to 1.  The
%%%%             prompts are automatically incremented.
%%%%       \MRunrestart
%%%%            Same as \NewSession
%%%%       \setpromptcount{10}
%%%%            To manually set the session prompt counter
%%%%            to "number". 
%%%%       \inprompt{In[5]//TeXForm:=}
%%%%            causes the automatic prompt to be bypassed and
%%%%            instead uses this for the input prompt.  The
%%%%            automatic prompt counter is still incremented.
%%%%            This must be called in the file before the cell 
%%%%            that it is numbering.
%%%%       \outprompt{Out[5]//TeXForm=}
%%%%            same as \inprompt for the output prompt.
%%%%       \promptbreaktrue
%%%%            causes a break right after the prompt so that
%%%%            the input or output rests under the prompt instead
%%%%            of beside it.
%%%%       \setmathindent{0pt}
%%%%            This sets the amount to indent the Input/Output sessions.
%%%%       \aboveinskip=\baselineskip
%%%%            This gives 1 line space above Mathematica inputs
%%%%       \belowinskip=\baselineskip
%%%%            This gives 1 line space below Mathematica inputs
%%%%       \aboveoutskip=.5\baselinskip
%%%%            This gives 1/2 line space above Mathematica outputs
%%%%       \belowoutskip=\baselineskip
%%%%            This gives 1 line space below Mathematica output
%%%%       \let\mathfontsize\footnotesize
%%%%            This sets the size for the Mathematica inputs/outputs
%%%%            to be footnotesize.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcount\promptcount \promptcount = 0
\def\MRunrestart{\global\promptcount = 0}\let\NewSession\MRunrestart
\def\setpromptcount#1{\global\promptcount=#1\global\advance\promptcount -1}
\def\advpromptcount#1{\global\advance\promptcount #1}
\def\inprompt#1{\global\inprompttrue\gdef\INPROMPT{#1}}
\def\outprompt#1{\global\outprompttrue\gdef\OUTPROMPT{#1}}
\def\OUTPROMPT{}\def\INPROMPT{}
\let\Outprompt\outprompt \let\Inprompt\inprompt
\newif\ifinprompt  \newif\ifoutprompt
\newif\ifprompt \promptfalse
\inpromptfalse \outpromptfalse
\newif\ifshowprompts \showpromptsfalse
\def\noprompts{\global\showpromptsfalse\global\promptfalse}
\def\showprompts{\global\showpromptstrue\global\prompttrue}
\showprompts
\newif\ifpromptbreak \promptbreakfalse
\def\In#1{{\ttfamily\itshape #1}}
\def\Inx#1{{\ttfamily\itshape #1}}
\def\Out#1{{\ttfamily\itshape\rule{0pt}{6pt}#1}}
\def\Outx#1{{\ttfamily\itshape #1}}
\newdimen\mathindent \mathindent = 0pt
\def\setmathindent#1{\global\mathindent=#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%              INCLUDING EPS GRAPHICS                      %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Use Tom Rokicki's utility to import graphics by default.
\input epsf.sty
%%%%
%%%% Usage:  \mathGraphic{file.eps}
%%%% You can change the width or height of the graphic by
%%%% using \xgraphic and \ygraphic.  Ex:  \xgraphic=3in
%%%% \xgraphic and \ygraphic must be called before the 
%%%% \mathGraphic macro.  Note that changing both can
%%%% change the aspect ratio of the graphic when using epsf.sty.
%%%%
%%%% If you have a nested .tex files, you might want to keep
%%%% some graphics in a different directory than the rest of
%%%% the document.  To make this work, you will need to use
%%%% \graphicdir{/newpath} before the \mathGraphic macro call.
%%%% \graphicdir remains set until another \graphicdir call
%%%% is seen.  The \xgraphic and \ygraphic dimens only effect
%%%% the very next \mathGraphic.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\graphicdir#1{\gdef\GRAPHDIR{#1}}
\graphicdir{}
\newdimen\xgraphic \xgraphic=0pt
\newdimen\ygraphic \ygraphic=0pt
\newdimen\defaultwid \defaultwid=0pt
\newdimen\defaultht \defaultht=0pt

\def\setdefaultgrsize#1#2{\global\defaultwid=#1\global\defaultht=#2}

\def\mathGraphic#1{%
	\vskip 1.5\baselineskip plus .25\baselineskip minus .25\baselineskip
	{\parindent 0pt%
	\ifdim\defaultwid > 0pt\epsfxsize\defaultwid\fi
	\ifdim\defaultht > 0pt\epsfxsize\defaultht\fi
	\ifdim\xgraphic > 0pt \epsfxsize\xgraphic\fi
	\ifdim\ygraphic > 0pt \epsfysize\ygraphic\fi
	\global\xgraphic=0pt\global\ygraphic=0pt
	\hbox to \hsize{\hss\epsffile{\GRAPHDIR #1}\hss}}\par
	\vskip 1\baselineskip plus .25\baselineskip minus .25\baselineskip
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\let\nils\nointerlineskip
\newbox\Minbox  \newbox\Moutbox

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \mathfontsize sets the size of the Mathematica inputs/outputs
%% (default size is \footnotesize)

\global\let\mathfontsize\footnotesize

\catcode`\^^I=13  % make tab a character

{\catcode`\^^M=13 {\catcode`\^^I=13 \catcode`\ =13 %\catcode`\-=13%
\gdef\verbatimdefs{%
\def^^M{\ \par\penalty70\relax}\let =\ \def^^I{        }}}%
\gdef\verbatimgobble#1^^M{}}

\def\mathIn{%
\global\setbox\Moutbox=\hbox{}\gdef\MGRAPHNAME{}%
\global\setbox\Minbox=\vtop\bgroup% 
\parskip 0pt\parindent 0pt\mathfontsize%
\mathversion{monobold}\ttfamily\bfseries%
\baselineskip 12pt%
\raggedright\nils%\hsize=\rightcom%
\def\do##1{\catcode`##1=12 }\dospecials%
\catcode`\ =13 \catcode`\^^M=13 \catcode`\^^I=13\catcode`\\=0%
\edef\\{\char"5C\relax} \def^^I{\ \ \ \ \ \ \ \ }% Width of "Tab"
\verbatimdefs\verbatimgobble\monospace}

\newif\ifprint \printfalse
\def\mathOut{%
\global\setbox\Moutbox=\vtop\bgroup% 
\parskip 0pt\parindent 0pt\mathfontsize%
\mathversion{mono}\ttfamily\mdseries
\raggedright\nils% 	FONT SIZE/LEADING
\def\do##1{\catcode`##1=12 }\dospecials%
\catcode`\ =13 \catcode`\^^M=13 \catcode`\^^I=13\catcode`\\=0%
\def^^I{\ \ \ \ \ \ \ \ }% Width of "Tab"
\verbatimdefs\verbatimgobble\monospace}


\def\mathText{%
\global\setbox\Moutbox=\vtop\bgroup% 
\parskip 0pt\parindent 0pt\mathfontsize%
\mathversion{mono}\ttfamily\mdseries%
\raggedright\nils% 	FONT SIZE/LEADING
\def\do##1{\catcode`##1=12 }\dospecials%
\catcode`\ =13 \catcode`\^^M=13 \catcode`\^^I=13\catcode`\\=0%
\edef\\{\char"5C\relax} \def^^I{\ \ \ \ \ \ \ \ }% Width of "Tab"
\verbatimdefs\verbatimgobble\monospace}

\catcode`\^^I=10  % make tab other

\def\endmathIn{\par\egroup\vskip-\lastskip\vskip\aboveinskip
		\vskip -\parskip%
	{\mathfontsize\parindent 0pt%
        \ifinprompt%
                \global\advance\promptcount by 1%
                \setbox\@tempboxa=\hbox{\In{\INPROMPT\ \relax}}
                \leavevmode\ifpromptbreak\relax\else\hbox\fi%
					\bgroup\kern\mathindent\In{\INPROMPT\ \relax}%
        \else%
            \ifprompt%
                \global\advance\promptcount by 1%
                \setbox\@tempboxa=\hbox{\kern\mathindent%
					\In{In[\the\promptcount]:= }}%
                \leavevmode\hbox\bgroup\kern\mathindent%
					\In{In[\the\promptcount]:= }%
            \else%
                \setbox\@tempboxa=\hbox{}\leavevmode\hbox\bgroup
                    \mbox{}\kern\mathindent%
            \fi%
        \fi%
			\ifpromptbreak\hfill\break
				\rule{0pt}{7pt}\leavevmode\kern 4pt\fi%
            \vtop{%\baselineskip 12pt%
            \ifpromptbreak\relax\else\advance\hsize -\wd\@tempboxa\fi%
            \copy\Minbox\par}\egroup}%
			%\ifprompt\vskip \baselineskip%
			%\else
			{\ifdim \dp\Minbox > .5\baselineskip\relax \advance\belowinskip by 5pt\fi
			\vskip \belowinskip}
			\global\inpromptfalse\global\promptbreakfalse\global\prompttrue}

\def\endmathOut{\par\egroup\@ifnextchar[{\@setoutdrop}{\@setoutdrop[0]}}
\def\@setoutdrop[#1]{{\mathfontsize\parindent 0pt%
	\vskip-\lastskip\vskip\aboveoutskip\vskip -1pt% Fudge a point for looks%
    \nils\leavevmode\ifpromptbreak\relax\else\hbox{\fi%
    \ifprompt\lower #1\baselineskip\fi%
    \ifoutprompt%
        \hbox{\kern\mathindent\Out{\OUTPROMPT\ \relax}}%
    \else%
        \ifprompt%
            \hbox{\kern\mathindent\Out{Out[\the\promptcount]= }}%
        \else%
            \mbox{}\kern\mathindent%
        \fi%
    \fi%
	\ifpromptbreak\hfill\break%
			\rule{0pt}{7pt}\leavevmode\kern 4pt\fi%
    \vtop{\advance\hsize -\wd\@tempboxa%
        \box\Moutbox\par}\ifpromptbreak\relax\else}\fi
		{\ifdim \dp\Moutbox > .5\baselineskip\relax 
			\advance\belowoutskip by 5pt\fi%
			\vskip \belowoutskip}
}\global\outpromptfalse\global\promptbreakfalse%
	\global\printfalse\global\prompttrue}

\def\endmathText{\par\egroup
	\vskip-\lastskip\vskip\aboveoutskip
    \vtop{\box\Moutbox\par}
    \vskip \belowoutskip}

\let\mathin\mathIn
\let\endmathin\endmathIn
\let\mathout\mathOut
\let\endmathout\endmathOut
\let\mathtext\mathText
\let\endmathtext\endmathText


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  \fixttmath
%%    makes the alphabetic math atoms come from family 0 (roman) 
%%    instead of family 1.  (Used for creating Mathematica's StandardForm.)
%%    Also redefine some macros to look like Mathematica StandardForm.

\def\mmamathopredefs{%
\def\log{\mathop{\operator@font Log}\nolimits}%
\def\sin{\mathop{\operator@font Sin}\nolimits}%
\def\arcsin{\mathop{\operator@font ArcSin}\nolimits}%
\def\sinh{\mathop{\operator@font Sinh}\nolimits}%
\def\cos{\mathop{\operator@font Cos}\nolimits}%
\def\arccos{\mathop{\operator@font ArcCos}\nolimits}%
\def\cosh{\mathop{\operator@font Cosh}\nolimits}%
\def\tan{\mathop{\operator@font Tan}\nolimits}%
\def\arctan{\mathop{\operator@font ArcTan}\nolimits}%
\def\tanh{\mathop{\operator@font Tanh}\nolimits}%
\def\cot{\mathop{\operator@font Cot}\nolimits}%
\def\coth{\mathop{\operator@font Coth}\nolimits}%
\def\sec{\mathop{\operator@font Sec}\nolimits}%
\def\csc{\mathop{\operator@font Csc}\nolimits}%
\def\max{\mathop{\operator@font Max}}%
\def\min{\mathop{\operator@font Min}}%
\def\arg{\mathop{\operator@font Arg}\nolimits}%
\def\det{\mathop{\operator@font Det}}%
\def\exp{\mathop{\operator@font Exp}\nolimits}%
\def\Pr{\mathop{\operator@font Pr}}%
\def\gcd{\mathop{\operator@font GCD}}%
\def\imag{I}%
}
\def\imag{i}  %% for normal text math

\def\fixttmath{\mmamathopredefs%
	\mathcode`\A="0041\mathcode`\B="0042\mathcode`\C="0043\mathcode`\D="0044%
	\mathcode`\E="0045\mathcode`\F="0046\mathcode`\G="0047\mathcode`\H="0048%
	\mathcode`\I="0049\mathcode`\J="004A\mathcode`\K="004B\mathcode`\L="004C%
	\mathcode`\M="004D\mathcode`\N="004E\mathcode`\O="004F\mathcode`\P="0050%
	\mathcode`\Q="0051\mathcode`\R="0052\mathcode`\S="0053\mathcode`\T="0054%
	\mathcode`\U="0055\mathcode`\V="0056\mathcode`\W="0057\mathcode`\X="0058%
	\mathcode`\Y="0059\mathcode`\Z="005A%
	\mathcode`\a="0061\mathcode`\b="0062\mathcode`\c="0063\mathcode`\d="0064%
	\mathcode`\e="0065\mathcode`\f="0066\mathcode`\g="0067\mathcode`\h="0068%
	\mathcode`\i="0069\mathcode`\j="006A\mathcode`\k="006B\mathcode`\l="006C%
	\mathcode`\m="006D\mathcode`\n="006E\mathcode`\o="006F\mathcode`\p="0070%
	\mathcode`\q="0071\mathcode`\r="0072\mathcode`\s="0073\mathcode`\t="0074%
	\mathcode`\u="0075\mathcode`\v="0076\mathcode`\w="0077\mathcode`\x="0078%
	\mathcode`\y="0079\mathcode`\z="007A%
}

\newskip\aboveinskip \aboveinskip.5\baselineskip plus 4.5pt minus 1pt
\newskip\belowinskip \belowinskip-.01\baselineskip plus 2.5pt minus 1pt
\newskip\aboveoutskip \aboveoutskip.05\baselineskip plus 2.5pt minus 1pt
\newskip\belowoutskip \belowoutskip.01\baselineskip plus 2.5pt minus 1pt

%\newskip\aboveinskip \aboveinskip\baselineskip
%\newskip\belowinskip \belowinskip\baselineskip
%\newskip\aboveoutskip \aboveoutskip .25\baselineskip
%\newskip\belowoutskip \belowoutskip\baselineskip

\newif\ifmatharray \matharrayfalse
\long\def\dispSFinmath{\@ifnextchar[{\dodispSFinmath}{\dodispSFinmath[n]}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  \dodispSFinmath, \dodispSFoutmath, \dodispTFinmath, \dodispTFoutmath
%%  macros produce Mathematica StandardForm input and output and
%%  TraditionalForm input and output respectively.  All these macros
%%  have similar usage.  Ex:
%%  \dodispSFinmath[p]{2 + 2}
%%  The optional p gives the Mathematica input/output the flexibility to
%%  break across pages if need be.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\long\def\dodispSFinmath[#1]#2{%%
	\vskip-\lastskip
    \if #1p
		\vskip \aboveinskip %
	\else
		\vskip\aboveinskip\global\matharrayfalse
		\global\setbox\Minbox=\vbox
	\fi{\parindent 0pt\mathfontsize%
	\if #1p
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[t]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[t]}}
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	\ifinprompt\global\advance\promptcount by 1%
			\leavevmode\kern\mathindent\In{\INPROMPT\ \relax}%
	\else\ifprompt%
			\global\advance\promptcount by 1%
			\leavevmode%
			\ifpromptbreak%
					\kern\mathindent\In{In[\the\promptcount]:= }\break
					\bgroup\mbox{}\kern\mathindent\kern 12pt
			\else\kern\mathindent\In{In[\the\promptcount]:= }%
			\fi%
       	\else%
			\leavevmode\mbox{}\kern\mathindent%
	\fi\fi%
	\def\Mvariable##1{\mathrm{##1}}%
	\mathversion{monobold}\fixttmath\ttfamily\bfseries $\displaystyle #2$%
	\ifprompt\else\ifshowprompts\global\prompttrue\fi\fi%
	\global\inpromptfalse\global\promptbreakfalse}%
	\if #1p\relax\else\copy\Minbox\fi%
	{\ifmatharray\advance\belowinskip 3pt\global\matharrayfalse\fi%
	\vskip\belowinskip}}

\long\def\dispSFoutmath{\@ifnextchar[{\dodispSFoutmath}{\dodispSFoutmath[n]}}
\def\dispSFDisplayFormulamath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFChemicalFormulamath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFInlineFormulamath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFInlineInputmath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFInputOnlymath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFNumberedTablemath#1{\dispSFoutmath{#1}}

\long\def\dodispSFoutmath[#1]#2{%%
	\vskip-\lastskip\vskip\aboveoutskip%
	\global\setbox\Moutbox=\vbox
	{\parindent 0pt\mathfontsize%
	\if #1p
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[t]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[t]}}
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	\ifoutprompt%
			\leavevmode\kern\mathindent\Out{\OUTPROMPT\ \relax}%
	\else\ifprompt%
			\leavevmode%
			\ifpromptbreak%
					\kern\mathindent\Out{Out[\the\promptcount]= \relax}\break
					\bgroup\mbox{}\kern\mathindent\kern 12pt
			\else\kern\mathindent\Out{Out[\the\promptcount]= \relax}%
			\fi%
       	\else%
			\leavevmode\mbox{}\kern\mathindent%
	\fi\fi%
	\def\Mvariable##1{\mathrm{##1}}%
	\mathversion{mono}\fixttmath\ttfamily$\displaystyle #2$%
	\ifprompt\else\ifshowprompts\global\prompttrue\fi\fi%
	\global\outpromptfalse\global\promptbreakfalse}%
	\if #1p\relax\else\copy\Moutbox\fi%
	{\ifmatharray\advance\belowoutskip 3pt\global\matharrayfalse\fi%
	\vskip\belowoutskip}}


\long\def\dispTFinmath{\@ifnextchar[{\dodispTFinmath}{\dodispTFinmath[n]}}
\def\dispTFDisplayFormulamath#1{\promptfalse\dispTFinmath{#1}}
\def\dispTFChemicalFormulamath#1{\promptfalse\dispTFinmath{#1}}
\def\dispTFInlineFormulamath#1{\promptfalse\dispTFinmath{#1}}
\def\dispTFInlineInputmath#1{\promptfalse\dispTFinmath{#1}}
\def\dispTFInputOnlymath#1{\promptfalse\dispTFinmath{#1}}
\def\dispTFNumberedTablemath#1{\dispTFinmath{#1}}

\long\def\dodispTFinmath[#1]#2{%%
	\vskip-\lastskip%
    \if #1p
		\vskip \aboveinskip %plus .167\baselineskip
	\else
		\vskip\aboveinskip\global\matharrayfalse
		\global\setbox\Minbox=\vbox
	\fi{\parindent 0pt\mathfontsize%
	\if #1p
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[t]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[t]}}
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	\ifinprompt\global\advance\promptcount by 1%
			\leavevmode\kern\mathindent\In{\INPROMPT\ \relax}%
	\else\ifprompt%
			\global\advance\promptcount by 1%
			\leavevmode%
			\ifpromptbreak%
					\kern\mathindent\In{In[\the\promptcount]:= \relax}\break
					\bgroup\mbox{}\kern\mathindent\kern 12pt
			\else\kern\mathindent\In{In[\the\promptcount]:= \relax}%
			\fi%
       	\else%
			\leavevmode\mbox{}\kern\mathindent%
	\fi\fi%
	\def\Mvariable##1{\mathit{##1}}%
	\mathversion{bold}\fixttmath$\displaystyle #2$%
	\ifprompt\else\ifshowprompts\global\prompttrue\fi\fi%
	\global\inpromptfalse\global\promptbreakfalse}%
	\if #1p\relax\else\copy\Minbox\fi\vskip\belowinskip}

\long\def\dispTFoutmath{\@ifnextchar[{\dodispTFoutmath}{\dodispTFoutmath[n]}}
\def\dispTFDisplayFormulamath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFChemicalFormulamath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFInlineFormulamath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFInlineInputmath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFInputOnlymath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFNumberedTablemath#1{\dispTFoutmath{#1}}

\long\def\dodispTFoutmath[#1]#2{%%
	\vskip-\lastskip\vskip\aboveoutskip%
	\global\setbox\Moutbox=\vbox
	{\parindent 0pt\mathfontsize%
	\if #1p
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[t]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[t]}}
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	\ifoutprompt%
			\leavevmode\kern\mathindent\Out{\OUTPROMPT\ \relax}%
	\else\ifprompt%
			\leavevmode%
			\ifpromptbreak%
					\kern\mathindent\Out{Out[\the\promptcount]= \relax}\break
					\bgroup\mbox{}\kern\mathindent\kern 12pt
			\else\kern\mathindent\Out{Out[\the\promptcount]= \relax}%
			\fi%
       	\else%
			\leavevmode\mbox{}\kern\mathindent%
	\fi\fi%
	\def\Mvariable##1{\mathrm{##1}}%
	$\displaystyle #2$%
	\ifprompt\else\ifshowprompts\global\prompttrue\fi\fi%
	\global\outpromptfalse\global\promptbreakfalse}%
	\if #1p\relax\else\copy\Moutbox\fi\vskip\belowoutskip}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Don't display Mathematica input inline math bold by default.
%% 	Inline math macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\inlineinmath#1{$#1$}
\def\inlineoutmath#1{$#1$}
\long\def\inlineSFinmath#1{{\mathversion{monobold}$#1$}}
\long\def\inlineSFoutmath#1{{\mathversion{mono}$#1$}}

\def\inlineSFDisplayFormulamath#1{\inlineSFoutmath{#1}}
\def\inlineSFChemicalFormulamath#1{\inlineSFoutmath{#1}}
\def\inlineSFInlineFormulamath#1{\inlineSFoutmath{#1}}
\def\inlineSFInlineInputmath#1{\inlineSFoutmath{#1}}
\def\inlineSFInputOnlymath#1{\inlineSFoutmath{#1}}
\def\inlineSFNumberedTablemath#1{\inlineSFoutmath{#1}}

\long\def\inlineTFinmath#1{$#1$}
\let\inlineTFoutmath\inlineTFinmath

\def\inlineTFDisplayFormulamath#1{\inlineTFoutmath{#1}}
\def\inlineTFChemicalFormulamath#1{\inlineTFoutmath{#1}}
\def\inlineTFInlineFormulamath#1{\inlineTFoutmath{#1}}
\def\inlineTFInlineInputmath#1{\inlineTFoutmath{#1}}
\def\inlineTFInputOnlymath#1{\inlineTFoutmath{#1}}
\def\inlineTFNumberedTablemath#1{\inlineTFoutmath{#1}}

\let\inlineTFTextmath\inlineSFoutmath
\let\inlineSFTextmath\inlineSFoutmath

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 	Display math macros  
%%       (always display the display math (input/output cells) as 
%%       Mathematica input/output)  Don't display like a plain math 
%%       equation.  If centered display math is preferred, uncomment
%%     
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\long\def\dispTFmath{\@ifnextchar[{\dodispTFmath}{\dodispTFmath[n]}}
\long\def\dodispTFmath[#1]#2{%
    \if #1p
		\vskip .83\baselineskip plus .167\baselineskip
		\bgroup\par\parindent 0pt%
		\leftskip 0pt plus 1fill\rightskip 0pt plus 1fill
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
		\leavevmode
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[c]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[c]}}
		\global\matharrayfalse
		$$
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	#2%
	\if #1p\par\egroup\vskip .83\baselineskip plus .167\baselineskip%
	\else$$\fi}

\long\def\dispSFPrintmath#1{\promptfalse\dispSFoutmath{#1}}
\let\dispTFPrintmath\dispSFPrintmath
\let\dispSFTextmath\dispSFPrintmath
\let\dispTFTextmath\dispSFPrintmath
\let\dispSFMessagemath\dispSFPrintmath
\let\dispTFMessagemath\dispSFPrintmath

\long\def\Message#1{\vskip-\lastskip\vskip\aboveoutskip%
	{\parindent 0pt\mathfontsize\ttfamily%
	\def\Mvariable##1{\mathtt{##1}}%
	\def\Mfunction##1{\mathtt{##1}}%
	\def\Muserfunction##1{\mathtt{##1}}%
	\def\Mstring##1{\hbox{##1}}%
	\mathversion{mono}#1\par}\vskip.5\baselineskip}
\let\Print\Message


\def\Mfunction#1{\mathrm{#1}}
\def\Muserfunction#1{\mathrm{#1}}
\def\Mvariable#1{\mathrm{#1}}
\def\Mstring#1{\hbox{#1}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%  Macros for Special Cell conversions.  Currently defined to do nothing.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\Mspecialone{}
\def\endMspecialone{}
\def\Mspecialtwo{}
\def\endMspecialtwo{}
\def\Mspecialthree{}
\def\endMspecialthree{}
\def\Mspecialfour{}
\def\endMspecialfour{}
\def\Mspecialfive{}
\def\endMspecialfive{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  \TeXSaveMessage{the message} - displays message from TeXSave conversion
%%  \noTeXSaveMessages - To turn off messages from the TeXSave conversion
%%  \showTeXSaveMessages - Show messages from the TeXSave conversion
%%                         (\showTeXSaveMessages is the default behavior)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifshowTSMessage \showTSMessagetrue
\def\noTeXSaveMessages{\showTSMessagefalse}
\def\showTeXSaveMessages{\showTSMessagetrue}

\newwrite\TSwrite
\def\TSoutmessage#1{{\let\protect\string\immediate\write\TSwrite{#1}}}

\long\def\TeXSaveMessage#1{\ifshowTSMessage%
	\TSoutmessage{** TeXSave Message: #1}%
	\errmessage{ TeXSave Message: Hit Return to continue.}\fi}

\def\overvar#1#2{\setbox0=\hbox{$#1$}\setbox2=\hbox{$#2$}%
  \dimen1=\ht0\advance\dimen1 .2ex%
  \ifdim\wd0>\wd2\relax%
        \raise\dimen1\hbox to 0pt{\hbox to \wd0{\hss$#2$\hss}\hss}%
                \hbox to \wd0{\hss $#1$\hss}%
        \else\raise\dimen1\hbox to 0pt{$#2$\hss}
                \hbox to \wd2{\hss$#1$\hss}\fi}

\newdimen\figboxrulewt\figboxrulewt=.5pt
\def\figbox#1#2{\vbox{%
        \hrule height \figboxrulewt%
                \hbox{\vrule width \figboxrulewt%
                        \hskip -2\figboxrulewt%
                        \vbox{\vbox to #2{\hbox to #1{\hss}\vss}%
                        \vskip -2\figboxrulewt}%
                \vrule width \figboxrulewt}%
        \hrule height \figboxrulewt}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Inline Typewriter font macros

\def\mv#1{\relax\ifmmode\mathtt{#1}\else\texttt{#1}\fi}
\def\mvi#1{\relax\ifmmode\mathtt{\itshape #1}\else\texttt{\itshape #1}\fi}
\def\mvb#1{\relax\ifmmode\mathtt{\bfseries #1}\else\texttt{\bfseries #1}\fi}
\def\mvbi#1{\relax\ifmmode\mathtt{\bfseries\itshape #1}%
	\else\texttt{\bfseries\itshape #1}\fi}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  GRAY BOX MACROS (\graybox, \buttonbox, \GrayOne, and \GrayTwo)
%%
%%  The following defines macros to create Gray boxes.   The package
%%  uses PostScript code to accomplish this and is currently using
%%  dvips's \special syntax to add the PS code.  If you are
%%  not using dvips, you may need to search for the \special
%%  commands and change the syntax to whatever your DVI to PS
%%  converter requires.
%%
%%  Usage:
%%     \GrayOne{This is some text}
%%     \GrayTwo{This is some text}
%%
%%  \GrayOne creates a box with no border rule and a background
%%  of 80% white (.8 setgray)
%%
%%  \GrayTwo creates a box with a hairline border rule and a background
%%  of 90% white (.9 setgray)
%% 
%%  It is easy to define your own type of gray box by using the 
%%  the macro \graybox.  The definition for \GrayOne is:
%%
%%  \long\def\GrayOne#1{\graybox{#1}{0}{.8}}
%%
%%  where the usage of \graybox is:
%%
%%  \graybox{text to appear in gray box}
%%          {border rule width (in PS points)}
%%          {graylevel of box background. 0.0 = black and 1.0 = white}
%%  
%%  The dimen below defines the amount of space from the edge of the box
%%  to the text contained within the box.  It is currently set to be 6pt.
%%
\newdimen\gboxsep \gboxsep 6pt           
%%
%%  \abovegraybox and \belowgraybox define the amount of white
%%  space above and below the boxes respectively.
%%  The default it 1.1\baselineskip and \baselineskip respectively.
%%
\newskip\abovegraybox  \abovegraybox 1.1\baselineskip plus 3.5pt minus 3.5pt
\newskip\belowgraybox  \belowgraybox 1\baselineskip plus 3.5pt minus 3.5pt
%%
%%  \boxparskip sets the amount of vertical white space between
%%  paragraphs within the gray boxes.  The default setting is 6pt.
%%
\newdimen\boxparskip \boxparskip 6pt
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\def\par{}                     %%  make \pars print as spaces in PS file
\special{! userdict begin       %%  begin User's PS definitions

/BPconv { 65781.76 div } bind def  %% Converts a TeX scaled point to PS bp

%%************************************************************************
%% DrawGrayBox draws the box using the arguments that were supplied
%%     from the macro, \makegray.
%%************************************************************************

/DrawGrayBox {
        /THEBOXGRAY exch def
        /BOXBORDERWIDTH exch def
        newpath
        BOXBORDERWIDTH setlinewidth
        BPconv /BOXDP exch def
        BPconv /BOXHT exch def
        BPconv /BOXWD exch def
        0 BOXDP neg moveto
        0 BOXHT BOXDP add rlineto
        BOXWD 0 rlineto
        0 BOXHT BOXDP add neg rlineto
        closepath gsave THEBOXGRAY setgray fill grestore 
        BOXBORDERWIDTH 0 gt {stroke} if
} bind def
end}}

\def\makegray#1#2#3#4#5{\special{" #1 #2 #3 #4 #5 DrawGrayBox }}

\newcount\tmpcntone \newcount\tmpcnttwo \newcount\tmpcntthree

%% #1 text to go in box
%% #2 width of border rule (in points)
%% #3 graylevel of background
             
\long\def\graybox#1#2#3{\vskip-\lastskip%
	\penalty-500\vskip\abovegraybox\vbox{\vskip\gboxsep%
	\setbox0=\hbox{\hskip\gboxsep\relax%
	\vbox{\parindent 0pt\parskip\boxparskip%
			\advance\hsize-2\gboxsep #1}%
	\hskip\gboxsep}%
    \tmpcntone=\dp0 \advance\tmpcntone\gboxsep 
    \tmpcnttwo=\ht0 \advance\tmpcnttwo\gboxsep
    %\tmpcntthree=\wd0   %%  This makes the box as wide as contained text.
	\tmpcntthree=\hsize  %%  This makes the box as wide as text area.
	\noindent%
    \makegray{\the\tmpcntthree}{\the\tmpcnttwo}{\the\tmpcntone}{#2}{#3}%
	\box0\relax\vskip\gboxsep}%
	\vskip\belowgraybox}

\long\def\GrayOne#1{\graybox{#1}{0}{.8}}

\long\def\GrayTwo#1{\graybox{#1}{.5}{.9}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Button Box section.
%% PostScript code to draw the Button is defined below.

{\def\par{}                     %%  make \pars print as spaces in PS file
\special{! userdict begin       %%  begin User's PS definitions

/DrawButtonBox {
        /BUTTONGRAY exch def      % Button background color
        /BUTTONBORDER exch def    % Butten border width
        newpath                   % make gray background
        BPconv /BUTTONDP exch def
        BPconv /BUTTONHT exch def
        BPconv /BUTTONWD exch def
        BUTTONBORDER BUTTONDP neg moveto
        0 BUTTONHT BUTTONDP add rlineto
        BUTTONWD 0 rlineto
        0 BUTTONHT BUTTONDP add neg rlineto
        closepath gsave BUTTONGRAY setgray fill 
        newpath                   % make bottom shading
        0 BUTTONDP BUTTONBORDER add neg moveto
        BUTTONBORDER BUTTONBORDER rlineto
        BUTTONWD 0 rlineto
        0 BUTTONBORDER neg rlineto
        closepath gsave 0 setgray fill 
        newpath                   % make right shading
        BUTTONBORDER BUTTONWD add BUTTONDP BUTTONBORDER add neg moveto
        0 BUTTONHT BUTTONDP add BUTTONBORDER add rlineto
        BUTTONBORDER BUTTONBORDER rlineto
        0 BUTTONHT BUTTONDP add 2 BUTTONBORDER mul add neg rlineto
        closepath gsave 0 setgray fill 
		grestore 
} bind def
}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \makebutton adds the PS code to draw the button.
%%
%% #1 = Width of button
%% #2 = Height of button
%% #3 = Depth of button
%% #4 = background gray of button (0 = black, 1 = white)
%% #5 = Button border width in PostScript points
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\makebutton#1#2#3#4#5{\special{" #1 #2 #3 #4 #5 DrawButtonBox }}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  \buttonbox[<buttonstyle>]{<converted BoxContents>}
%%
%%      Used to display ButtonCells from Mathematica Notebooks.
%%  
%%  Possible <buttonstyle>s and their behavior:
%%    *  MainBookLink
%%			 underlines <converted BoxContents>
%%    *  all other <buttonstyle>s
%%           Produces a button with a gray background if called in math mode
%%          (usually StandardForm <\dispSFinmath or \dispSFoutmath> or
%%           TraditionalForm <\dispTFinmath or \dispTFoutmath>).
%%          If \buttonbox is called in text mode, this just
%%          displays <converted BoxContents> as regular tex.
%%    * NOTE: New <buttonstyle> options and behavior can be added to the 
%%            \buttonbox macro below using the \CheckBstyle macro.
%%
%%  The following dimen defines the amount of space from the edge of the button
%%  to the text contained within the box.  It is currently set to be 4pt.
%%
\newdimen\buttonsep \buttonsep 6pt           
%%
%% \setbuttongray{.8} sets the graylevel of the background of the button
%%              where 0 is black and 1 is white.
%%
\def\setbuttongray#1{\gdef\buttongray{#1}}
\setbuttongray{.8}
%%
%% \setbuttonborder{4} sets the width of the button border to be 4
%%              PostScript points.
%%
\def\setbuttonborder#1{\gdef\buttonborder{#1}}
\setbuttonborder{2}
%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\if@notfound   % Boolean to determine if button style has
                     % been found in the list of options or not.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \CheckBStyle
%%   #1 = Name of ButtonStyle
%%   #2 = display behavior for that ButtonStyle
%%
\def\CheckBStyle#1#2{%
	\if@notfound\def\btemp{#1}%
		\ifx\buttonstyle\btemp #2\@notfoundfalse\fi\fi}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\long\def\buttonbox[#1]#2{{%
	\@notfoundtrue\def\buttonstyle{#1}%
	\CheckBStyle{MainBookLink}{\underline{#2}}%
    %% Default behavior for unknown <buttonstyle>'s
	\if@notfound\relax\ifmmode\dobuttonbox{#2}\else #2\fi\fi}}

\long\def\dobuttonbox#1{%
	\setbox0=\hbox{\hskip\buttonsep #1\hskip\buttonsep}
	\ifdim\wd0 > .8\hsize\relax
		\setbox0=\hbox{\hskip\buttonsep\relax%
			\vtop{\advance\hsize-2\buttonsep\advance\hsize-2\buttonborder pt%
				  \parindent 0pt\parskip\boxparskip%
			\advance\hsize-2\buttonsep #1}%
			\hskip\buttonsep}%
	\fi%
    \tmpcntone=\dp0 \advance\tmpcntone\buttonsep 
    \tmpcnttwo=\ht0 \advance\tmpcnttwo\buttonsep
    \tmpcntthree=\wd0   %%  This makes the box as wide as contained text.
	%\tmpcntthree=\hsize  %%  This makes the box as wide as text area.
    \makebutton{\the\tmpcntthree}{\the\tmpcnttwo}{\the\tmpcntone}
		{\buttonborder}{\buttongray}%
	\hskip\buttonborder pt\box0\relax}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The below is due to an inconsistency with TeXSave and wrisym.sty.
%% wrisym.sty expects the following characters to be in math mode
%% and TeXSave/TeXForm doesn't, so we need to redefine the macros
%% so that they do the right thing no matter how things are coded.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\ScriptCapitalA{\relax\ifmmode\scA\else$\scA$\fi}
\def\ScriptCapitalB{\relax\ifmmode\scB\else$\scB$\fi}
\def\ScriptCapitalC{\relax\ifmmode\scC\else$\scC$\fi}
\def\ScriptCapitalD{\relax\ifmmode\scD\else$\scD$\fi}
\def\ScriptCapitalE{\relax\ifmmode\scE\else$\scE$\fi}
\def\ScriptCapitalF{\relax\ifmmode\scF\else$\scF$\fi}
\def\ScriptCapitalG{\relax\ifmmode\scG\else$\scG$\fi}
\def\ScriptCapitalH{\relax\ifmmode\scH\else$\scH$\fi}
\def\ScriptCapitalI{\relax\ifmmode\scI\else$\scI$\fi}
\def\ScriptCapitalJ{\relax\ifmmode\scJ\else$\scJ$\fi}
\def\ScriptCapitalK{\relax\ifmmode\scK\else$\scK$\fi}
\def\ScriptCapitalL{\relax\ifmmode\scL\else$\scL$\fi}
\def\ScriptCapitalM{\relax\ifmmode\scM\else$\scM$\fi}
\def\ScriptCapitalN{\relax\ifmmode\scN\else$\scN$\fi}
\def\ScriptCapitalO{\relax\ifmmode\scO\else$\scO$\fi}
\def\ScriptCapitalP{\relax\ifmmode\scP\else$\scP$\fi}
\def\ScriptCapitalQ{\relax\ifmmode\scQ\else$\scQ$\fi}
\def\ScriptCapitalR{\relax\ifmmode\scR\else$\scR$\fi}
\def\ScriptCapitalS{\relax\ifmmode\scS\else$\scS$\fi}
\def\ScriptCapitalT{\relax\ifmmode\scT\else$\scT$\fi}
\def\ScriptCapitalU{\relax\ifmmode\scU\else$\scU$\fi}
\def\ScriptCapitalV{\relax\ifmmode\scV\else$\scV$\fi}
\def\ScriptCapitalW{\relax\ifmmode\scW\else$\scW$\fi}
\def\ScriptCapitalX{\relax\ifmmode\scX\else$\scX$\fi}
\def\ScriptCapitalY{\relax\ifmmode\scY\else$\scY$\fi}
\def\ScriptCapitalZ{\relax\ifmmode\scZ\else$\scZ$\fi}

\def\ScriptA{\relax\ifmmode\sca\else$\sca$\fi}
\def\ScriptB{\relax\ifmmode\scb\else$\scb$\fi}
\def\ScriptC{\relax\ifmmode\scc\else$\scc$\fi}
\def\ScriptD{\relax\ifmmode\scd\else$\scd$\fi}
\def\ScriptE{\relax\ifmmode\sce\else$\scr$\fi}
\def\ScriptF{\relax\ifmmode\scf\else$\scf$\fi}
\def\ScriptG{\relax\ifmmode\scg\else$\scg$\fi}
\def\ScriptH{\relax\ifmmode\sch\else$\sch$\fi}
\def\ScriptI{\relax\ifmmode\sci\else$\sci$\fi}
\def\ScriptJ{\relax\ifmmode\scj\else$\scj$\fi}
\def\ScriptK{\relax\ifmmode\sck\else$\sck$\fi}
\def\ScriptL{\relax\ifmmode\scl\else$\scl$\fi}
\def\ScriptM{\relax\ifmmode\scm\else$\scm$\fi}
\def\ScriptN{\relax\ifmmode\scn\else$\scn$\fi}
\def\ScriptO{\relax\ifmmode\sco\else$\sco$\fi}
\def\ScriptP{\relax\ifmmode\scp\else$\scp$\fi}
\def\ScriptQ{\relax\ifmmode\scq\else$\scq$\fi}
\def\ScriptR{\relax\ifmmode\scr\else$\scr$\fi}
\def\ScriptS{\relax\ifmmode\scs\else$\scs$\fi}
\def\ScriptT{\relax\ifmmode\sct\else$\sct$\fi}
\def\ScriptU{\relax\ifmmode\scu\else$\scu$\fi}
\def\ScriptV{\relax\ifmmode\scv\else$\scv$\fi}
\def\ScriptW{\relax\ifmmode\scw\else$\scw$\fi}
\def\ScriptX{\relax\ifmmode\scx\else$\scx$\fi}
\def\ScriptY{\relax\ifmmode\scy\else$\scy$\fi}
\def\ScriptZ{\relax\ifmmode\scz\else$\scz$\fi}

\def\DoubleStruckCapitalA{\relax\ifmmode\dsA\else$\dsA$\fi}
\def\DoubleStruckCapitalB{\relax\ifmmode\dsB\else$\dsB$\fi}
\def\DoubleStruckCapitalC{\relax\ifmmode\dsC\else$\dsC$\fi}
\def\DoubleStruckCapitalD{\relax\ifmmode\dsD\else$\dsD$\fi}
\def\DoubleStruckCapitalE{\relax\ifmmode\dsE\else$\dsE$\fi}
\def\DoubleStruckCapitalF{\relax\ifmmode\dsF\else$\dsF$\fi}
\def\DoubleStruckCapitalG{\relax\ifmmode\dsG\else$\dsG$\fi}
\def\DoubleStruckCapitalH{\relax\ifmmode\dsH\else$\dsH$\fi}
\def\DoubleStruckCapitalI{\relax\ifmmode\dsI\else$\dsI$\fi}
\def\DoubleStruckCapitalJ{\relax\ifmmode\dsJ\else$\dsJ$\fi}
\def\DoubleStruckCapitalK{\relax\ifmmode\dsK\else$\dsK$\fi}
\def\DoubleStruckCapitalL{\relax\ifmmode\dsL\else$\dsL$\fi}
\def\DoubleStruckCapitalM{\relax\ifmmode\dsM\else$\dsM$\fi}
\def\DoubleStruckCapitalN{\relax\ifmmode\dsN\else$\dsN$\fi}
\def\DoubleStruckCapitalO{\relax\ifmmode\dsO\else$\dsO$\fi}
\def\DoubleStruckCapitalP{\relax\ifmmode\dsP\else$\dsP$\fi}
\def\DoubleStruckCapitalQ{\relax\ifmmode\dsQ\else$\dsQ$\fi}
\def\DoubleStruckCapitalR{\relax\ifmmode\dsR\else$\dsR$\fi}
\def\DoubleStruckCapitalS{\relax\ifmmode\dsS\else$\dsS$\fi}
\def\DoubleStruckCapitalT{\relax\ifmmode\dsT\else$\dsT$\fi}
\def\DoubleStruckCapitalU{\relax\ifmmode\dsU\else$\dsU$\fi}
\def\DoubleStruckCapitalV{\relax\ifmmode\dsV\else$\dsV$\fi}
\def\DoubleStruckCapitalW{\relax\ifmmode\dsW\else$\dsW$\fi}
\def\DoubleStruckCapitalX{\relax\ifmmode\dsX\else$\dsX$\fi}
\def\DoubleStruckCapitalY{\relax\ifmmode\dsY\else$\dsY$\fi}
\def\DoubleStruckCapitalZ{\relax\ifmmode\dsZ\else$\dsZ$\fi}
\def\DoubleStruckCapitalA{\relax\ifmmode\dsA\else$\dsA$\fi}

\def\DoubleStruckA{\relax\ifmmode\dsa\else$\dsa$\fi}
\def\DoubleStruckB{\relax\ifmmode\dsb\else$\dsb$\fi}
\def\DoubleStruckC{\relax\ifmmode\dsc\else$\dsc$\fi}
\def\DoubleStruckD{\relax\ifmmode\dsd\else$\dsd$\fi}
\def\DoubleStruckE{\relax\ifmmode\dse\else$\dse$\fi}
\def\DoubleStruckF{\relax\ifmmode\dsf\else$\dsf$\fi}
\def\DoubleStruckG{\relax\ifmmode\dsg\else$\dsg$\fi}
\def\DoubleStruckH{\relax\ifmmode\dsh\else$\dsh$\fi}
\def\DoubleStruckI{\relax\ifmmode\dsi\else$\dsi$\fi}
\def\DoubleStruckJ{\relax\ifmmode\dsj\else$\dsj$\fi}
\def\DoubleStruckK{\relax\ifmmode\dsk\else$\dsk$\fi}
\def\DoubleStruckL{\relax\ifmmode\dsl\else$\dsl$\fi}
\def\DoubleStruckM{\relax\ifmmode\dsm\else$\dsm$\fi}
\def\DoubleStruckN{\relax\ifmmode\dsn\else$\dsn$\fi}
\def\DoubleStruckO{\relax\ifmmode\dso\else$\dso$\fi}
\def\DoubleStruckP{\relax\ifmmode\dsp\else$\dsp$\fi}
\def\DoubleStruckQ{\relax\ifmmode\dsq\else$\dsq$\fi}
\def\DoubleStruckR{\relax\ifmmode\dsr\else$\dsr$\fi}
\def\DoubleStruckS{\relax\ifmmode\dss\else$\dss$\fi}
\def\DoubleStruckT{\relax\ifmmode\dst\else$\dst$\fi}
\def\DoubleStruckU{\relax\ifmmode\dsu\else$\dsu$\fi}
\def\DoubleStruckV{\relax\ifmmode\dsv\else$\dsv$\fi}
\def\DoubleStruckW{\relax\ifmmode\dsw\else$\dsw$\fi}
\def\DoubleStruckX{\relax\ifmmode\dsx\else$\dsx$\fi}
\def\DoubleStruckY{\relax\ifmmode\dsy\else$\dsy$\fi}
\def\DoubleStruckZ{\relax\ifmmode\dsz\else$\dsz$\fi}

\def\GothicCapitalA{\relax\ifmmode\goA\else$\goA$\fi}
\def\GothicCapitalB{\relax\ifmmode\goB\else$\goB$\fi}
\def\GothicCapitalC{\relax\ifmmode\goC\else$\goC$\fi}
\def\GothicCapitalD{\relax\ifmmode\goD\else$\goD$\fi}
\def\GothicCapitalE{\relax\ifmmode\goE\else$\goE$\fi}
\def\GothicCapitalF{\relax\ifmmode\goF\else$\goF$\fi}
\def\GothicCapitalG{\relax\ifmmode\goG\else$\goG$\fi}
\def\GothicCapitalH{\relax\ifmmode\goH\else$\goH$\fi}
\def\GothicCapitalI{\relax\ifmmode\goI\else$\goI$\fi}
\def\GothicCapitalJ{\relax\ifmmode\goJ\else$\goJ$\fi}
\def\GothicCapitalK{\relax\ifmmode\goK\else$\goK$\fi}
\def\GothicCapitalL{\relax\ifmmode\goL\else$\goL$\fi}
\def\GothicCapitalM{\relax\ifmmode\goM\else$\goM$\fi}
\def\GothicCapitalN{\relax\ifmmode\goN\else$\goN$\fi}
\def\GothicCapitalO{\relax\ifmmode\goO\else$\goO$\fi}
\def\GothicCapitalP{\relax\ifmmode\goP\else$\goP$\fi}
\def\GothicCapitalQ{\relax\ifmmode\goQ\else$\goQ$\fi}
\def\GothicCapitalR{\relax\ifmmode\goR\else$\goR$\fi}
\def\GothicCapitalS{\relax\ifmmode\goS\else$\goS$\fi}
\def\GothicCapitalT{\relax\ifmmode\goT\else$\goT$\fi}
\def\GothicCapitalU{\relax\ifmmode\goU\else$\goU$\fi}
\def\GothicCapitalV{\relax\ifmmode\goV\else$\goV$\fi}
\def\GothicCapitalW{\relax\ifmmode\goW\else$\goW$\fi}
\def\GothicCapitalX{\relax\ifmmode\goX\else$\goX$\fi}
\def\GothicCapitalY{\relax\ifmmode\goY\else$\goY$\fi}
\def\GothicCapitalZ{\relax\ifmmode\goZ\else$\goZ$\fi}
\def\GothicCapitalA{\relax\ifmmode\goA\else$\goA$\fi}

\def\GothicA{\relax\ifmmode\goa\else$\goa$\fi}
\def\GothicB{\relax\ifmmode\gob\else$\gob$\fi}
\def\GothicC{\relax\ifmmode\goc\else$\goc$\fi}
\def\GothicD{\relax\ifmmode\god\else$\god$\fi}
\def\GothicE{\relax\ifmmode\goe\else$\goe$\fi}
\def\GothicF{\relax\ifmmode\gof\else$\gof$\fi}
\def\GothicG{\relax\ifmmode\gog\else$\gog$\fi}
\def\GothicH{\relax\ifmmode\goh\else$\goh$\fi}
\def\GothicI{\relax\ifmmode\goi\else$\goi$\fi}
\def\GothicJ{\relax\ifmmode\goj\else$\goj$\fi}
\def\GothicK{\relax\ifmmode\gok\else$\gok$\fi}
\def\GothicL{\relax\ifmmode\gol\else$\gol$\fi}
\def\GothicM{\relax\ifmmode\gom\else$\gom$\fi}
\def\GothicN{\relax\ifmmode\gon\else$\gon$\fi}
\def\GothicO{\relax\ifmmode\goo\else$\goo$\fi}
\def\GothicP{\relax\ifmmode\gop\else$\gop$\fi}
\def\GothicQ{\relax\ifmmode\goq\else$\goq$\fi}
\def\GothicR{\relax\ifmmode\gor\else$\gor$\fi}
\def\GothicS{\relax\ifmmode\gos\else$\gos$\fi}
\def\GothicT{\relax\ifmmode\got\else$\got$\fi}
\def\GothicU{\relax\ifmmode\gou\else$\gou$\fi}
\def\GothicV{\relax\ifmmode\gov\else$\gov$\fi}
\def\GothicW{\relax\ifmmode\gow\else$\gow$\fi}
\def\GothicX{\relax\ifmmode\gox\else$\gox$\fi}
\def\GothicY{\relax\ifmmode\goy\else$\goy$\fi}
\def\GothicZ{\relax\ifmmode\goz\else$\goz$\fi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Accented Character Macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Acute Macros
%%
\DeclareMathAccent{\doubleacute}{\mathalpha}{operators}{"22}

\def\CapitalAAcute{\relax\ifmmode\acute{A}\else\'{A}\fi}
\def\CapitalEAcute{\relax\ifmmode\acute{E}\else\'{E}\fi}
\def\CapitalIAcute{\relax\ifmmode\acute{I}\else\'{I}\fi}
\def\CapitalOAcute{\relax\ifmmode\acute{O}\else\'{O}\fi}
\def\CapitalUAcute{\relax\ifmmode\acute{U}\else\'{U}\fi}
\def\CapitalYAcute{\relax\ifmmode\acute{Y}\else\'{Y}\fi}
\def\CapitalCAcute{\relax\ifmmode\acute{C}\else\'{C}\fi}
\def\CapitalODoubleAcute{\relax\ifmmode\doubleacute{O}%
		\else$\doubleacute{O}$\fi}
\def\CapitalUDoubleAcute{\relax\ifmmode\doubleacute{U}%
		\else$\doubleacute{U}$\fi}
\def\AAcute{\relax\ifmmode\acute{a}\else\'{a}\fi}
\def\EAcute{\relax\ifmmode\acute{e}\else\'{e}\fi}
\def\IAcute{\relax\ifmmode\acute{i}\else\'{i}\fi}
\def\OAcute{\relax\ifmmode\acute{o}\else\'{o}\fi}
\def\UAcute{\relax\ifmmode\acute{u}\else\'{u}\fi}
\def\YAcute{\relax\ifmmode\acute{y}\else\'{y}\fi}
\def\CAcute{\relax\ifmmode\acute{c}\else\'{c}\fi}
\def\ODoubleAcute{\relax\ifmmode\doubleacute{o}%
		\else$\doubleacute{o}$\fi}
\def\UDoubleAcute{\relax\ifmmode\doubleacute{u}%
		\else$\doubleacute{u}$\fi}

%%
%% Grave Macros
%%

\def\CapitalAGrave{\relax\ifmmode\grave{A}\else\`{A}\fi}
\def\CapitalEGrave{\relax\ifmmode\grave{E}\else\`{E}\fi}
\def\CapitalIGrave{\relax\ifmmode\grave{I}\else\`{I}\fi}
\def\CapitalOGrave{\relax\ifmmode\grave{O}\else\`{O}\fi}
\def\CapitalUGrave{\relax\ifmmode\grave{U}\else\`{U}\fi}
\def\AGrave{\relax\ifmmode\grave{a}\else\`{a}\fi}
\def\EGrave{\relax\ifmmode\grave{e}\else\`{e}\fi}
\def\IGrave{\relax\ifmmode\grave{i}\else\`{i}\fi}
\def\OGrave{\relax\ifmmode\grave{o}\else\`{o}\fi}
\def\UGrave{\relax\ifmmode\grave{u}\else\`{u}\fi}

%%
%% Umlaut (DoubleDot) Macros
%%

\def\CapitalADoubleDot{\relax\ifmmode\ddot{A}\else\"{A}\fi}
\def\CapitalEDoubleDot{\relax\ifmmode\ddot{E}\else\"{E}\fi}
\def\CapitalIDoubleDot{\relax\ifmmode\ddot{I}\else\"{I}\fi}
\def\CapitalODoubleDot{\relax\ifmmode\ddot{O}\else\"{O}\fi}
\def\CapitalUDoubleDot{\relax\ifmmode\ddot{U}\else\"{U}\fi}
\def\ADoubleDot{\relax\ifmmode\ddot{a}\else\"{a}\fi}
\def\EDoubleDot{\relax\ifmmode\ddot{e}\else\"{e}\fi}
\def\IDoubleDot{\relax\ifmmode\ddot{i}\else\"{i}\fi}
\def\ODoubleDot{\relax\ifmmode\ddot{o}\else\"{o}\fi}
\def\UDoubleDot{\relax\ifmmode\ddot{u}\else\"{u}\fi}
\def\YDoubleDot{\relax\ifmmode\ddot{y}\else\"{y}\fi}

%%
%% Hat Macros
%%
%% Use \texthat in case \^ gets redefined for Mathematica code segments

\let\texthat\^  

\def\CapitalAHat{\relax\ifmmode\hat{A}\else\texthat{A}\fi}
\def\CapitalEHat{\relax\ifmmode\hat{E}\else\texthat{E}\fi}
\def\CapitalIHat{\relax\ifmmode\hat{I}\else\texthat{I}\fi}
\def\CapitalOHat{\relax\ifmmode\hat{O}\else\texthat{O}\fi}
\def\CapitalUHat{\relax\ifmmode\hat{U}\else\texthat{U}\fi}
\def\AHat{\relax\ifmmode\hat{a}\else\texthat{a}\fi}
\def\EHat{\relax\ifmmode\hat{e}\else\texthat{e}\fi}
\def\IHat{\relax\ifmmode\hat{i}\else\texthat{i}\fi}
\def\OHat{\relax\ifmmode\hat{o}\else\texthat{o}\fi}
\def\UHat{\relax\ifmmode\hat{u}\else\texthat{u}\fi}

%%
%% Bar Macros
%%

\def\ABar{\relax\ifmmode\bar{a}\else$\bar{a}$\fi}
\def\CapitalABar{\relax\ifmmode\bar{A}\else$\bar{A}$\fi}
\def\EBar{\relax\ifmmode\bar{e}\else$\bar{e}$\fi}
\def\CapitalEBar{\relax\ifmmode\bar{E}\else$\bar{E}$\fi}

%%
%% Cup Macros
%%

\def\ACup{\relax\ifmmode\breve{a}\else\u{a}\fi}
\def\CapitalACup{\relax\ifmmode\breve{A}\else\u{A}\fi}

%%
%% Tilde Macros
%%
%% Save \~ accent macro in case it gets redefined for Mathematica environment.
\let\texttilde\~  

\def\CapitalATilde{\relax\ifmmode\tilde{A}\else\texttilde{A}\fi}
\def\CapitalNTilde{\relax\ifmmode\tilde{N}\else\texttilde{N}\fi}
\def\CapitalOTilde{\relax\ifmmode\tilde{O}\else\texttilde{O}\fi}
\def\ATilde{\relax\ifmmode\tilde{a}\else\texttilde{a}\fi}
\def\NTilde{\relax\ifmmode\tilde{n}\else\texttilde{n}\fi}
\def\OTilde{\relax\ifmmode\tilde{o}\else\texttilde{o}\fi}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Misc. defs

\def\Angstrom{\relax\ifmmode\Angstroem\else$\Angstroem$\fi}
\DeclareMathSymbol{\circr}{\mathord}{symbols}{"FE}
\def\circledR{\relax\ifmmode\tm\else$\circr$\fi}
\def\DifferentialD{\relax\ifmmode\dd\else$\dd$\fi}
\def\DoublePrime{\relax\ifmmode\prime{}\prime\else$\prime{}\prime$\fi}
\def\ExponentialE{\relax\ifmmode\ee\else$\ee$\fi}
\let\FilledCircle\Circle
\def\FilledSmallCircle{\relax\ifmmode\bullet\else$\bullet$\fi}
\let\FilledSquare\Square
\def\hslash{\relax\ifmmode\hbar\else$\hbar$\fi} % workaround for TeXForm
\def\ImaginaryI{\relax\ifmmode\ii\else$\ii$\fi}
\def\ImaginaryJ{\relax\ifmmode\jj\else$\jj$\fi}
\let\InvisiblePrefixScriptBase\relax
\let\InvisibleSpace\relax
\DeclareMathSymbol{\LeftAngleBracket}{\mathopen}{symbols}{"68}
\def\LeftBracketingBar{|}
\let\LeftDoubleBracket\lpart
\def\LeftDoubleBracketingBar{\relax%
	\ifmmode\hbox{$\parallel$}\else$\parallel$\fi}
\DeclareMathSymbol{\leftsk}{\mathopen}{symbols}{"1C}
\def\LeftSkeleton{\relax\ifmmode\leftsk\else$\leftsk$\fi}
\def\NoBreak{\relax\ifmmode\relax\else\nolinebreak\fi}
\def\NonBreakingSpace{\relax\ifmmode\relax\else~\fi}
\def\RawTilde{\symbol{"7E}}
\def\RawWedge{\symbol{"5E}}
\DeclareMathSymbol{\RightAngleBracket}{\mathopen}{symbols}{"69}
\def\RightBracketingBar{|}
\let\RightDoubleBracket\rpart
\let\RightDoubleBracketingBar\LeftDoubleBracketingBar
\DeclareMathSymbol{\rightsk}{\mathclose}{symbols}{"1D}
\def\RightSkeleton{\relax\ifmmode\rightsk\else$\rightsk$\fi}
\def\SkeletonIndicator{\relax\ifmmode\hbox{-}\else -\relax\fi}
\DeclareMathSymbol{\tm}{\mathord}{symbols}{"FF}
\def\Trademark{\relax\ifmmode\tm\else$\tm$\fi}
\def\VerticalBar{|}
\def\VerticalSeparator{|}
\let\VeryThinSpace\,
\def\RawReturn{\par}
\def\multsp{\>}
%%

%% Center needs to be redefined if used with \MathBegin{} ...  \MathEnd{}
\def\center{\par\begingroup\trivlist \centering\item[]}
\def\endcenter{\endtrivlist\endgroup\par}

\def\unknown#1{#1}
\DeclareTextFontCommand{\textbi}{\bfseries\itshape}
\def\TeXSave{{\ttfamily TeXSave}}
\def\wriboldmath{\mathversion{bold}}
%%

\def\CellGroup{\bgroup}
\def\endCellGroup{\egroup}

